name: Branch Validation

on:
  push:
    branches-ignore:
      - main
      - master
      - 'dependabot/**'
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  validate-branch:
    runs-on: ubuntu-latest
    continue-on-error: true  # Informational only - doesn't block merge
    steps:
      - name: Check branch naming convention
        run: |
          BRANCH="${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}"
          echo "Validating branch name: $BRANCH"

          if ! echo "$BRANCH" | grep -Eq '^claude/[a-z0-9-]+-[A-Za-z0-9]{5,}$'; then
            echo ""
            echo "❌ Invalid branch name: $BRANCH"
            echo ""
            echo "Expected format: claude/<description>-<ID>"
            echo "  - description: lowercase letters, numbers, hyphens"
            echo "  - ID: random alphanumeric string (5+ chars)"
            echo ""
            echo "Examples:"
            echo "  ✓ claude/fix-cost-attribution-gap-ONScU"
            echo "  ✓ claude/review-old-pr-HVX49"
            echo "  ✓ claude/add-new-feature-abc12"
            echo ""
            echo "To fix:"
            echo "  git branch -m claude/your-description-xyz99"
            echo "  git push -u origin claude/your-description-xyz99"
            echo ""
            exit 1
          fi

          echo "✅ Branch name is valid!"
